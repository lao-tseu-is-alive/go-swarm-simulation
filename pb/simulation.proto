syntax = "proto3";

package pb;

option go_package = "github.com/lao-tseu-is-alive/go-swarm-simulation/pb";

// Sent by the World to tell actors to update their state
message Tick {
  int64 delta_time = 1; // Time elapsed since last frame
  Perception context = 2; // Optional field
}
message Vector  {
  double x = 1;
  double y = 2;
}
enum TeamColor {
  TEAM_UNSPECIFIED = 0;
  TEAM_RED = 1;
  TEAM_BLUE = 2;
}

// Sent by the World to ask for current status
message GetState {}

// The response containing the actor's data
message ActorState {
  string id = 1;
  TeamColor color = 2; // "RED" or "BLUE"
  Vector position = 3;
  Vector velocity = 4;
}
// Perception is sent by the world to tell an actor what neighbors are visible
message Perception {
  repeated ActorState targets = 1;
  repeated ActorState friends = 2;
}

// Convert message is the command to switch teams
message Convert {
  TeamColor target_color = 1;
}

// Sent by Individual -> World
message ReportStatus {
  ActorState state = 1;
}

// Sent by World -> UI (via channel, or actor if UI is an actor)
message WorldSnapshot {
  repeated ActorState actors = 1;
  int32 red_count = 2;
  int32 blue_count = 3;
  bool is_game_over = 4;
  string winner = 5;
}

// UpdateConfig allows runtime updates to all configuration parameters
message UpdateConfig {
	// Interaction Radii
	double detection_radius = 1;
	double defense_radius = 2;
	double contact_radius = 3;
	double visual_range = 4;
	double protected_range = 5;
	
	// Physics / Behavior
	double max_speed = 6;
	double min_speed = 7;
	double aggression = 8;
	
	// Boids Flocking Parameters
	double centering_factor = 9;
	double avoid_factor = 10;
	double matching_factor = 11;
	double turn_factor = 12;
	
	// Population (for reference, changes take effect on restart)
	int32 num_red_at_start = 13;
	int32 num_blue_at_start = 14;
	
	// Visualization
	bool display_detection_circle = 15;
	bool display_defense_circle = 16;
}
